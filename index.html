<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Hydr801 EMR</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:system-ui,-apple-system,sans-serif;background:#f5f7fa}
.container{max-width:800px;margin:40px auto;padding:20px}
.card{background:#fff;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,0.1);padding:24px;margin-bottom:20px}
h1{color:#1a56db;margin-bottom:20px}
h2{color:#333;margin-bottom:16px;font-size:18px}
.form-group{margin-bottom:16px}
label{display:block;font-size:12px;color:#666;margin-bottom:6px;text-transform:uppercase}
input[type="text"]{width:100%;padding:12px;border:1px solid #ddd;border-radius:8px;font-size:14px}
.btn{padding:12px 24px;border:none;border-radius:8px;cursor:pointer;font-size:14px;font-weight:500}
.btn-primary{background:#1a56db;color:#fff}
.btn-primary:hover{background:#1e429f}
.btn-orange{background:#ff6b35;color:#fff}
.status{padding:16px;border-radius:8px;margin:16px 0}
.status-ok{background:#d1fae5;color:#065f46}
.status-err{background:#fee2e2;color:#991b1b}
.status-warn{background:#fef3c7;color:#92400e}
.patients{margin-top:20px}
.patient{display:flex;justify-content:space-between;align-items:center;padding:12px;border:1px solid #e0e0e0;border-radius:8px;margin-bottom:8px}
.patient-info{font-weight:500}
.patient-email{font-size:12px;color:#666}
.tag{padding:4px 8px;border-radius:4px;font-size:11px}
.tag-synced{background:#d1fae5;color:#065f46}
.tag-pending{background:#fef3c7;color:#92400e}
</style>
</head>
<body>
<div class="container">
<div class="card">
<h1>Hydr801 EMR</h1>
<p style="color:#666;margin-bottom:20px">GoHighLevel Integration</p>

<div class="form-group">
<label>Server URL</label>
<input type="text" id="serverUrl" value="https://hydr801-backend-production-2c14.up.railway.app">
</div>

<button class="btn btn-primary" onclick="testConnection()">Test Connection</button>
<button class="btn btn-orange" onclick="testGHL()" style="margin-left:10px">Test GHL API</button>

<div id="result"></div>
</div>

<div class="card">
<h2>Patients</h2>
<div id="patients" class="patients"></div>
<button class="btn btn-orange" onclick="syncPatient()" style="margin-top:16px">Sync Test Patient to GHL</button>
<div id="syncResult"></div>
</div>
</div>

<script>
var patients = [
    {id:1, name:'Sarah Johnson', email:'sarah.j@email.com', ghlId:null},
    {id:2, name:'Michael Chen', email:'mchen@email.com', ghlId:null},
    {id:3, name:'Emily Rodriguez', email:'emily.r@email.com', ghlId:null}
];

function renderPatients() {
    var html = '';
    for (var i = 0; i < patients.length; i++) {
        var p = patients[i];
        html += '<div class="patient"><div><div class="patient-info">' + p.name + '</div><div class="patient-email">' + p.email + '</div></div><span class="tag ' + (p.ghlId ? 'tag-synced' : 'tag-pending') + '">' + (p.ghlId ? 'Synced' : 'Not synced') + '</span></div>';
    }
    document.getElementById('patients').innerHTML = html;
}

function testConnection() {
    var url = document.getElementById('serverUrl').value;
    document.getElementById('result').innerHTML = '<div class="status status-warn">Testing...</div>';
    
    fetch(url + '/api/health')
        .then(function(response) { return response.json(); })
        .then(function(data) {
            if (data.status === 'ok') {
                document.getElementById('result').innerHTML = '<div class="status status-ok">✓ Server Connected!</div>';
            } else {
                document.getElementById('result').innerHTML = '<div class="status status-err">✗ Unexpected response</div>';
            }
        })
        .catch(function(err) {
            document.getElementById('result').innerHTML = '<div class="status status-err">✗ Connection failed: ' + err.message + '</div>';
        });
}

function testGHL() {
    var url = document.getElementById('serverUrl').value;
    document.getElementById('result').innerHTML = '<div class="status status-warn">Testing GHL...</div>';
    
    fetch(url + '/api/ghl/contacts')
        .then(function(response) { return response.json(); })
        .then(function(data) {
            if (data.contacts) {
                document.getElementById('result').innerHTML = '<div class="status status-ok">✓ GHL Connected! Found ' + data.contacts.length + ' contacts</div>';
            } else if (data.error) {
                document.getElementById('result').innerHTML = '<div class="status status-err">✗ GHL Error: ' + data.error + '</div>';
            } else {
                document.getElementById('result').innerHTML = '<div class="status status-warn">Response: ' + JSON.stringify(data).substring(0, 100) + '</div>';
            }
        })
        .catch(function(err) {
            document.getElementById('result').innerHTML = '<div class="status status-err">✗ GHL failed: ' + err.message + '</div>';
        });
}

function syncPatient() {
    var url = document.getElementById('serverUrl').value;
    var p = patients[0];
    document.getElementById('syncResult').innerHTML = '<div class="status status-warn">Syncing...</div>';
    
    fetch(url + '/api/ghl/contacts', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
            firstName: 'Sarah',
            lastName: 'Johnson',
            email: p.email,
            phone: '8015550123',
            tags: ['Hydr801', 'EMR Patient'],
            source: 'Hydr801 EMR'
        })
    })
    .then(function(response) { return response.json(); })
    .then(function(data) {
        if (data.contact) {
            patients[0].ghlId = data.contact.id;
            renderPatients();
            document.getElementById('syncResult').innerHTML = '<div class="status status-ok">✓ Patient synced to GHL!</div>';
        } else {
            document.getElementById('syncResult').innerHTML = '<div class="status status-err">✗ Sync failed: ' + JSON.stringify(data) + '</div>';
        }
    })
    .catch(function(err) {
        document.getElementById('syncResult').innerHTML = '<div class="status status-err">✗ Sync error: ' + err.message + '</div>';
    });
}

renderPatients();
</script>
</body>
</html>
